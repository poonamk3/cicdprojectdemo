# name: Django CI

# on:
#   push:
#     branches: [ "master" ]
#   pull_request:
#     branches: [ "master" ]
# # on:
# #   push:
# #   pull_request:

# jobs:
#   build:

#     # runs-on: ubuntu-latest
#     runs-on: self-hosted

#     # services:
#     #   postgres:
#     #     image: postgres:latest
#     #     env:
#     #       POSTGRES_DB: cicd
#     #       POSTGRES_USER: postgres
#     #       POSTGRES_PASSWORD: psql
#     #     ports:
#     #       - 5432:5432

#     strategy:
#       max-parallel: 4
#       matrix:
#         python-version: [3.9]

#     steps:
#     - uses: actions/checkout@v3
#     - name: Set up Python ${{ matrix.python-version }}
#       uses: actions/setup-python@v3
#       with:
#         python-version: ${{ matrix.python-version }}
#     - name: Install Dependencies
#       run: |
#         python -m pip install --upgrade pip
#         # pip install -r requirements.txt
#         pip install pytest
      
#     # - name: Apply Migrations
#     #   run: |
#     #     python manage.py makemigrations
#     #     python manage.py migrate
            
#     # - name: Run Tests
#     #   run: |
#     #     pytest






on:
  push:
    branches:
      - '*'
  pull_request:
    branches:
      - '*'

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.9

      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install pytest

      # - name: Run Tests
      #   run: pytest

  deploy_master:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.9

      - name: Deploy to Production
        if: github.ref == 'refs/heads/master' && github.event_name == 'push'
        run: |
          # Add your deployment commands here
          echo "Deploying to production..."
          mkdir mainfolder

  deploy_other_branches:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.9

      - name: Deploy to Production (Other Branches)
        if: github.ref != 'refs/heads/master' || github.event_name == 'pull_request'
        run: |
          # Add your deployment commands for other branches here
          echo "Deploying to other branches..."
